{"version":3,"file":"index.js","sources":["../src/lib/env.js","../src/util/is.js","../src/lib/Data.js","../src/lib/Theme.js","../src/lib/Config.js","../src/lib/Peripherals.js","../src/lib/Template.js","../src/lib/Model.js","../src/lib/Output.js","../src/lib/Mole.js"],"sourcesContent":["let env = process.env.NODE_ENV\n\nexport default env\n","// array\nfunction arr(value) {\n\treturn value && typeof value === 'object' && value.constructor === Array\n}\n\n// bad\nfunction bad(value) {\n\treturn nll(value) || undef(value) || empty(value) || err(value)\n}\n\n// boolean\nfunction bool(value) {\n\treturn typeof value === 'boolean'\n}\n\n// empty\nfunction empty(value) {\n\treturn (\n\t\t(str(value) && value === '') ||\n\t\t(arr(value) && value.length === 0) ||\n\t\t(obj(value) && Object.keys(value).length === 0)\n\t)\n}\n\n// date\nfunction date(value) {\n\treturn value instanceof Date\n}\n\n// error\nfunction err(value) {\n\treturn value instanceof Error && typeof value.message !== 'undefined'\n}\n\n// json\nfunction json(value) {\n\ttry {\n\t\tJSON.parse(value)\n\t\treturn true\n\t} catch (e) {\n\t\treturn false\n\t}\n}\n\n// function\nfunction fn(value) {\n\treturn typeof value === 'function'\n}\n\n// integer\nfunction inte(value) {\n\treturn (\n\t\ttypeof value === 'number' && isFinite(value) && Number.isInteger(value)\n\t)\n}\n\n// null\nfunction nll(value) {\n\treturn value == null\n}\n\n// null or undefined\nfunction noru(value) {\n\treturn value == null || typeof value === 'undefined'\n}\n\n// number\nfunction num(value) {\n\treturn typeof value === 'number' && isFinite(value)\n}\n\n// object\nfunction obj(value) {\n\treturn value && typeof value === 'object' && value.constructor === Object\n}\n\n// promise\nfunction prom(value) {\n\treturn (\n\t\t!!value &&\n\t\t(typeof value === 'object' || typeof value === 'function') &&\n\t\ttypeof value.then === 'function'\n\t)\n}\n\n// regex\nfunction regex(value) {\n\treturn value && typeof value === 'object' && value.constructor === RegExp\n}\n\n// string\nfunction str(value) {\n\treturn typeof value === 'string' || value instanceof String\n}\n\n// symbol\nfunction sym(value) {\n\treturn typeof value === 'symbol'\n}\n\n// undefined\nfunction undef(value) {\n\treturn value === undefined || typeof value === 'undefined'\n}\n\nfunction path(value) {\n\treturn /\\/|\\./im.test(value)\n}\n\nfunction dir(value) {\n\treturn /^\\.?\\/?(\\w+\\/)+/im.test(value)\n}\n\nfunction file(value) {\n\treturn /\\/\\w+$|\\w+\\.\\w+$/im.test(value)\n}\n\n// if type of $value is true, $fn1() else $fn2()\nfunction typa(check, value, fn1, fn2) {\n\tif (!noru(check) && !noru(value) && !noru(fn1) && !noru(fn2)) {\n\t\treturn is[check](value) ? fn1 : fn2\n\t} else {\n\t\tthrow new Error('Invalid parameters.')\n\t}\n}\n\n// return type(s) of $value\nfunction what(value) {\n\tlet what = []\n\tconst checks = [\n\t\t{ fn: 'arr', name: 'array' },\n\t\t{ fn: 'bool', name: 'boolean' },\n\t\t{ fn: 'date', name: 'date' },\n\t\t{ fn: 'err', name: 'error' },\n\t\t{ fn: 'fn', name: 'function' },\n\t\t{ fn: 'inte', name: 'integer' },\n\t\t{ fn: 'json', name: 'json' },\n\t\t{ fn: 'nll', name: 'null' },\n\t\t{ fn: 'num', name: 'number' },\n\t\t{ fn: 'obj', name: 'object' },\n\t\t{ fn: 'file', name: 'file' },\n\t\t{ fn: 'dir', name: 'dir' },\n\t\t{ fn: 'path', name: 'path' },\n\t\t{ fn: 'prom', name: 'promise' },\n\t\t{ fn: 'regex', name: 'regexp' },\n\t\t{ fn: 'str', name: 'string' },\n\t\t{ fn: 'sym', name: 'symbol' },\n\t\t{ fn: 'undef', name: 'undefined' }\n\t]\n\tchecks.forEach(check => {\n\t\tif (is[check.fn](value)) what.push(check.name)\n\t})\n\tif (is.noru(value)) throw new Error('Missing value to test.')\n\n\treturn what[0]\n}\n\nconst is = {\n\tarr,\n\tbad,\n\tbool,\n\tdate,\n\tempty,\n\terr,\n\tfn,\n\tinte,\n\tjson,\n\tnll,\n\tnoru,\n\tnum,\n\tobj,\n\tfile,\n\tdir,\n\tpath,\n\tprom,\n\tregex,\n\tstr,\n\tsym,\n\ttypa,\n\tundef,\n\twhat\n}\n\nexport default is\n","import clone from 'lodash.clonedeep'\n\nexport class Data {\n\tclone(theme) {\n\t\tObject.assign(this, clone(theme))\n\t}\n\tupdate(data) {\n\t\tObject.assign(this, data)\n\t}\n}\n\nconst data = new Data()\n\nexport default data\n","import fs from 'fs'\n// import jsonnet from '@unboundedsystems/jsonnet'\nimport glob from 'glob'\nimport is from '../util/is'\nimport data from './Data'\nimport merge from 'lodash.merge'\n\nconst jsonnet = require('@unboundedsystems/jsonnet');\n\nconst RE_JS = /([a-zA-Z0-9\\s_\\\\.\\-\\(\\):])+(.js)$/im\nconst RE_JSONNET = /([a-zA-Z0-9\\s_\\\\.\\-\\(\\):])+(.jsonnet)$/im\n\n\n\nclass Theme {\n\tconstructor() {\n\t\treturn this\n\t}\n\tset(value, config) {\n\n\t\t// Parses the theme\n\t\tlet result\n\n\t\tif (is.what(value) === 'path' || is.what(value) === 'file' || is.what(value) === 'dir') {\n\n\t\t\tlet path = getThemePath(config, value)\n\n\t\t\tif (RE_JS.test(path)) {\n\t\t\t\tresult = require(file)\n\n\t\t\t}\n\t\t\tif (RE_JSONNET.test(path)) {\n\n\t\t\t\tconst getFile = fs.readFileSync(path).toString()\n\n\n\t\t\t\tconst jsonnetVm = new jsonnet.Jsonnet()\n\n\t\t\t\tresult = jsonnetVm.eval(getFile)\n\n\t\t\t\tjsonnetVm.destroy()\n\t\t\t}\n\t\t} else if (is.what(value) === 'object') {\n\t\t\tresult = value\n\t\t} else {\n\t\t\tresult = {}\n\t\t}\n\n\t\t// If theme already set then merge with new settings\n\t\tif (theme.result) {\n\t\t\tresult = Object.assign(theme.result, result)\n\t\t}\n\n\t\tmerge(this, result)\n\t\tdata.clone(theme)\n\t}\n}\n\nfunction getThemePath(config, value) {\n\n\tlet path = ''\n\tlet files\n\n\t// If theme is specified as a dir\n\tif (is.what(value) === 'dir') {\n\t\tfiles = glob.sync(process.cwd() + '/' + value + '**/*')\n\t}\n\n\t// If theme is specified as a file\n\tif (is.what(value) === 'file') {\n\n\t\tfiles = glob.sync(process.cwd() + '/' + value)\n\n\t}\n\n\t// Check if file is one of supported extensions\n\tfiles.map(function (file) {\n\t\tif (RE_JS.test(file) || RE_JSONNET.test(file)) {\n\t\t\tpath = file\n\t\t}\n\t})\n\n\treturn path\n}\n\nconst theme = new Theme()\n\nexport { data }\n\nexport default theme\n","import theme from './Theme'\nimport env from './env'\nimport fs from 'fs-extra'\n\nclass Config {\n\tconstructor() {\n\t\treturn this\n\t}\n\tset(value) {\n\t\t// console.log(value)\n\t\t// Get the input value for the config\n\t\tlet input\n\t\t// Check if value is a path to a file or an object\n\t\tif (typeof value === 'string') {\n\t\t\tif (fs.existsSync(process.cwd() + '/' + value)) {\n\n\t\t\t\tinput = require(process.cwd() + '/' + value)\n\t\t\t\t// console.log(input)\n\n\t\t\t}\n\t\t}\n\n\t\tif (typeof value === 'object') {\n\t\t\tinput = value\n\t\t}\n\n\t\tif (input) {\n\t\t\tlet result = {}\n\n\t\t\t// Record the root of where the file is stored\n\t\t\tlet dir = ''\n\n\t\t\t// If path is matches a directory\n\t\t\tif (value.match(/(.*)[\\/\\\\]/)) {\n\t\t\t\tdir = value.match(/(.*)[\\/\\\\]/)[1] + '/'\n\t\t\t}\n\n\t\t\tresult.root = process.cwd() + '/' + dir || ''\n\t\t\tresult.rootOnly = dir\n\t\t\t// Record the absolute path to the file\n\t\t\tresult.path = process.cwd() + '/' + value\n\n\t\t\t// Assign the properties of the input to the object we created\n\t\t\tresult = Object.assign(result, input)\n\n\t\t\t// For model, template and output we must put them into arrays\n\t\t\t;\n\t\t\t['model', 'template', 'output'].forEach(function(current) {\n\t\t\t\tif (result[current]) result[current] = putValuesIntoArray(result[current])\n\t\t\t})\n\n\t\t\t// Then we normalise the outputs\n\t\t\tresult = normaliseOutputs(result)\n\n\t\t\t// If a theme is specified in the config input then we set the theme\n\t\t\tif (result.theme) {\n\t\t\t\ttheme.set(result.rootOnly + result.theme, result)\n\t\t\t}\n\t\t\t// We assign the new properties to the Config object\n\t\t\tObject.assign(this, result)\n\t\t}\n\t}\n}\n\nfunction normaliseOutputs(config) {\n\n\tlet result = config.output.map(function(output) {\n\t\tif (typeof output === 'undefined') {\n\t\t\tthrow new Error('No outputs specified in config')\n\t\t}\n\n\t\t// Check for name\n\t\tlet name\n\t\tif (typeof output.file === 'undefined') {\n\t\t\tname = Object.keys(output)[0]\n\t\t} else {\n\t\t\tname = null\n\t\t}\n\n\t\t// Check for model\n\t\tlet model\n\t\tif (output.model) {\n\t\t\tmodel = output.model\n\t\t} else if (config.model) {\n\t\t\tmodel = config.model\n\t\t} else {\n\t\t\tmodel = null\n\t\t}\n\n\t\t// Check for template\n\t\tlet template\n\t\tif (output.template) {\n\t\t\ttemplate = output.template\n\t\t} else if (config.template) {\n\t\t\ttemplate = config.template\n\t\t} else {\n\t\t\ttemplate = null\n\t\t}\n\n\t\t// Check for directory\n\t\tlet dir\n\t\tif (output.dir) {\n\t\t\tif (config.dir) {\n\t\t\t\tdir = config.root + config.dir + output.dir\n\t\t\t} else {\n\t\t\t\tdir = config.root + output.dir\n\t\t\t}\n\t\t} else if (config.dir) {\n\t\t\tdir = config.root + config.dir\n\t\t} else {\n\t\t\tdir = config.root + ''\n\t\t}\n\n\t\t// Check for file\n\t\tlet file\n\t\tif (typeof output.file === 'undefined') {\n\t\t\tfile = output[name].file\n\n\t\t} else {\n\t\t\tfile = output.file\n\n\t\t}\n\n\t\treturn Object.assign({}, { name, model, template, dir, file })\n\t})\n\n\tconfig.output = result\n\n\treturn config\n}\n\nfunction putValuesIntoArray(value) {\n\treturn Array.isArray(value) ? value : [value]\n}\n\nconst config = new Config()\n\nif (env === 'test') {\n\tconfig.set('src/stub/config.js')\n} else {\n\tconfig.set('mole.config.js')\n}\n\nexport default config\n","/**\n * Creates a list of Peripherals which contain `models` and/or `templates`\n * ```js\n * {\n *\tmodels: [\n *\t\t{ name: 'model-name', data: '' }\n *\t],\n *\ttemplates: [\n *\t\t{ name: 'template-name', string: '' }\n *\t]\n * }\n * ```\n * @memberof Mole\n * @property {Array} models A list of models\n * @property {Array} templates A list of templates\n */\n\nclass Peripherals {\n\tconstructor() {\n\t\tthis.model = []\n\t\tthis.template = []\n\t}\n}\n\nconst peripherals = new Peripherals()\n\nexport default peripherals\n","// import theme from './Theme'\nimport clone from 'lodash.clonedeep'\n\nimport { stripIndent } from 'common-tags'\n\nvar output = \"\";\n\nfunction acc(strings, ...values) {\n\n\n\tif (!strings) {\n\t\tif (typeof output !== \"undefined\") {\n\n\t\t\treturn output;\n\t\t} else {\n\n\t\t\treturn str;\n\t\t}\n\n\t}\n\telse {\n\n\n\t\tlet str = '';\n\n\t\tstrings.forEach((string, a) => {\n\t\t\tif (typeof values[a] === 'object' && values[a] !== null) {\n\n\t\t\t\tvar { prefix, side, i, abbr } = values[a]\n\n\t\t\t\tif ((prefix || abbr) && side && i) {\n\t\t\t\t\tvalues[a] = `[${prefix || abbr}-${side}~=\"${i}\"]`;\n\t\t\t\t}\n\n\t\t\t\tif ((prefix || abbr) && i) {\n\t\t\t\t\tvalues[a] = `[${prefix || abbr}~=\"${i}\"]`;\n\t\t\t\t}\n\n\t\t\t\telse if ((prefix || abbr) && side) {\n\t\t\t\t\tvalues[a] = `[${prefix || abbr}-${side}]`;\n\t\t\t\t}\n\n\t\t\t\telse if (prefix || abbr) {\n\t\t\t\t\tvalues[a] = `[${prefix || abbr}]`;\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t// if (Array.isArray(values[i])) {\n\t\t\t// \tvalues[i] = values[i].join('')\n\t\t\t// }\n\t\t\tstr += string + (values[a] || '');\n\t\t});\n\n\t\tstr = stripIndent(str);\n\n\n\t\tif (typeof output !== \"undefined\") {\n\t\t\toutput += `${str}\\n`;\n\t\t}\n\n\n\n\t\treturn str;\n\t}\n\n\n}\n\n\n/**\n * Creates a new user defined template\n * @memberof Mole.Peripherals\n * @param {string} name Name of the template\n * @param {Mole.Peripherals.Template~function|string} func A callback that returns a string for the template\n * @return {{name: string, func: function, output: string}} An object with a `name`, a `func`, and an optional `output` property\n * @example\n * // Example while exporting as module\n * import Template from 'mole'\n *\n * export default new Template('template-name', function(model) {\n * \t\treturn // The string you'd like to return to be parsed\n * \t})\n * )\n */\nclass Template {\n\tconstructor(name, func, theme, data, active) {\n\t\t/**\n\t\t * Callback for returning a template string\n\t\t * @callback Mole.Peripherals.Template~function\n\t\t * @param {Object} data - Access to the data model\n\t\t * @param {Object} theme - Access the original theme data\n\t\t * @return {String} Returns a string which is rendered using a templating engine\n\t\t */\n\n\t\ttheme = clone(theme)\n\n\t\tdeepFreeze(theme)\n\t\tthis.name = name\n\t\tthis.active = active\n\t\tthis.string = func(data, theme, name, acc)\n\t}\n}\n\nfunction deepFreeze(object) {\n\n\t// Retrieve the property names defined on object\n\tvar propNames = Object.getOwnPropertyNames(object);\n\n\t// Freeze properties before freezing self\n\n\tfor (let name of propNames) {\n\t\tlet value = object[name];\n\n\t\tobject[name] = value && typeof value === \"object\" ?\n\t\t\tdeepFreeze(value) : value;\n\t}\n\n\treturn Object.freeze(object);\n}\n\n\n\nexport default Template\n","// console.log(theme)\nimport clone from 'lodash.clonedeep'\n\n// export class Model {\n// \tconstructor(name, callback) {\n// \t\tthis.name = name\n// \t\t// This updates mole.model with changes from plugin\n// \t\tObject.assign(mole.model, Object.getPrototypeOf(callback(mole.model)))\n// \t\t// console.log(mole.model)\n// \t}\n// }\n\n/**\n * Creates a new user defined model\n * @memberof Mole.Peripherals\n * @param {string} name Name of the model\n * @param {Mole.Peripherals.Model~function|object} func A callback that returns an object for the model\n * @return {{name: string, func: function, output: string}} An object with a `name`, a `func`, and an optional `output` property\n *\n * @example\n * // Example using `add()` method\n * mole.add(\n * \tnew Model('model-name', function(data) {\n * \t\treturn // The object you'd like to return which sets the data model\n * \t})\n * )\n */\n\nclass Model {\n\tconstructor(name, func, theme, data, active) {\n\t\tthis.name = name\n\t\tthis.active = active\n\t\tdata = clone(data)\n\t\tthis.data = func(theme, data)\n\t}\n}\n\nexport default Model\n","import is from '../util/is'\nimport fs from 'fs-extra'\nimport merge from 'lodash.merge'\nimport glob from 'glob'\nimport Template from './Template'\nimport Model from './Model'\n\nclass Output {\n\tconstructor(output, peripherals, config, theme, data) {\n\t\tObject.assign(this, {\n\t\t\tname: output.name,\n\t\t\t...getContent(output, peripherals, config, theme, data),\n\t\t\tpath: output.dir + output.file\n\t\t})\n\t}\n}\n\nfunction getContent(output, peripherals, config, theme, data) {\n\n\tlet object = {}\n\n\tfor (let type in peripherals) {\n\n\t\tif (output['model'] === null) {\n\t\t\toutput[type] = data\n\t\t}\n\n\t\t// Temporary fix for when template is not defined in config\n\t\tif (output['template'] === null) {\n\t\t\toutput[type] = ['xxxxx']\n\t\t}\n\n\t\tif (output[type]) {\n\t\t\tlet result = []\n\n\t\t\tfor (let value in output[type]) {\n\n\n\n\t\t\t\tswitch (is.what(output[type][value])) {\n\t\t\t\t\tcase 'dir':\n\t\t\t\t\t\t// eg \"templates/\"\n\t\t\t\t\t\tresult.push(getContentFromDirs(output[type][value], output, peripherals, type, config, theme, data))\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase 'file':\n\t\t\t\t\t\t// eg \"templates/files.njk\"\n\t\t\t\t\t\tresult.push(getFileContent(output[type][value], type, config, theme, data))\n\t\t\t\t\t\tbreak\n\t\t\t\t\tcase 'string':\n\t\t\t\t\t\tif (peripherals[type]) {\n\n\t\t\t\t\t\t\t// Check if any peripherals have been added\n\t\t\t\t\t\t\tif (peripherals[type].length > 0) {\n\t\t\t\t\t\t\t\tfor (let peripheral of peripherals[type]) {\n\t\t\t\t\t\t\t\t\t// console.log(output[type][value])\n\n\t\t\t\t\t\t\t\t\tif (output[type][value] === peripheral.name) {\n\t\t\t\t\t\t\t\t\t\tperipheral.active = true\n\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\t// console.log(`Does not match a named ${type}, please check`)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (peripheral.active) {\n\t\t\t\t\t\t\t\t\t\tresult.push(peripheral.data || peripheral.string)\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// When model is added using config, but doesn't exist then set model to data. Needs improving\n\t\t\t\t\t\t\t\tresult.push(data)\n\t\t\t\t\t\t\t\t// console.log(`No ${type}s added yet`)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log(`No ${type}s named '${output[type][value]}', please check`)\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tresult.push(output[type])\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif (type === 'model') {\n\t\t\t\tobject[type] = merge(...result)\n\t\t\t}\n\t\t\tif (type === 'template') {\n\t\t\t\tobject[type] = result.join('\\n')\n\t\t\t}\n\t\t}\n\n\t}\n\t// console.log('object -> ', object)\n\treturn object\n}\n\nfunction getContentFromDirs(dir, output, peripherals, type, config, theme, data) {\n\tlet keys = []\n\tkeys = Object.keys(data)\n\tkeys.push('index')\n\tkeys = keys.join('|')\n\t// console.log(keys)\n\n\tlet result = []\n\n\t// If has subdirectory that matches named output eg \"templates/ios/\"\n\tif (fs.existsSync(config.root + dir + output.name + '/')) {\n\t\t// console.log('has matching directories')\n\t\t// Get files that match model eg \"templates/ios/class.njk\" or \"templates/ios/index.njk\"\n\t\tlet files = glob.sync(config.root + dir + output.name + '/@(' + keys + ')*')\n\n\t\tfor (let file of files) {\n\n\t\t\t// console.log(fs.readFileSync(file, 'utf8'))\n\t\t\tif (/\\.js$/gmi.test(file)) {\n\t\t\t\tif (type === 'model') {\n\t\t\t\t\tlet model = new Model('name', require(file), theme, data)\n\t\t\t\t\tresult.push(model.data)\n\t\t\t\t\tdata.update(model.data)\n\n\t\t\t\t}\n\n\t\t\t\tif (type === 'template') {\n\t\t\t\t\tresult.push(new Template('name', require(file), theme, data).string)\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tresult.push(fs.readFileSync(file, 'utf8'))\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\t\t// If main directory has file that matches named output eg \"templates/ios.njk\"\n\t\t// TODO: Could possibly also check if filename matches model eg. \"ios.class.njk\"\n\t\tlet files = glob.sync(config.root + dir + output.name + '*')\n\n\t\tfor (let file of files) {\n\n\t\t\tif (/\\.js$/gmi.test(file)) {\n\t\t\t\tif (type === 'model') {\n\t\t\t\t\tlet model = new Model('name', require(file), theme, data)\n\t\t\t\t\tresult.push(model.data)\n\t\t\t\t\tdata.update(model.data)\n\n\t\t\t\t}\n\t\t\t\tif (type === 'template') {\n\t\t\t\t\tresult.push(new Template('name', require(file), theme, data).string)\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tresult.push(fs.readFileSync(file, 'utf8'))\n\t\t\t}\n\t\t}\n\t}\n\n\tif (type === 'model') {\n\t\treturn merge(...result)\n\t}\n\tif (type === 'template') {\n\t\treturn result.join('\\n')\n\t}\n\n}\n\nfunction getFileContent(file, type, config, theme, data) {\n\n\tif (/\\.js$/gmi.test(file)) {\n\t\tif (type === 'model') {\n\t\t\tlet model = new Model('name', require(config.root + file), theme, data)\n\t\t\tdata.update(model.data)\n\n\t\t\treturn model.data\n\t\t}\n\t\tif (type === 'template') {\n\t\t\treturn new Template('name', require(config.root + file), theme, data).string\n\t\t}\n\t} else {\n\t\treturn fs.readFileSync(config.root + file, 'utf8')\n\t}\n}\n\n// Todo: Add functionality to get template or model from user defined model of template\nfunction getPluginContent(value, type) {\n\tfor (let plugin of type) {\n\t\tif (value === plugin.name) {\n\t\t\treturn plugin.string || plugin.data\n\t\t}\n\t}\n}\n\nexport default Output\n","import config from './Config'\nimport theme from './Theme'\nimport fs from 'fs-extra'\nimport peripherals from './Peripherals'\nimport env from './env'\nimport { data } from './Theme'\nimport Output from './Output'\nimport Model from './Model'\nimport Template from './Template'\n\nimport nunjucks from 'nunjucks'\nconst nunjucksEnv = nunjucks.configure()\n\nlet files = []\n\nlet things = []\n\nclass Mole {\n\tconstructor() { }\n\tconfig(value) {\n\t\tconfig.set(value)\n\t}\n\ttheme(value) {\n\t\ttheme.set(value, config)\n\t}\n\tregister(...args) {\n\t\t// If values provided as an array then use the array as args\n\t\tif (args[0]) {\n\t\t\targs = args[0]\n\t\t}\n\n\t\tif (args[0] === 'model') {\n\t\t\tlet model = new Model(args[1], args[2], theme, data)\n\t\t\tperipherals.model.push(model)\n\t\t\tdata.update(model.data)\n\t\t}\n\n\t\tif (args[0] === 'template') {\n\t\t\tperipherals.template.push(new Template(args[1], args[2], theme, data))\n\t\t}\n\t\tthis._outputs()\n\t}\n\tuse(...args) {\n\n\t\t// If values provided as an array then use the array as args\n\t\tif (args[0]) {\n\t\t\targs = args[0]\n\t\t}\n\n\t\tif (args[0] === 'model') {\n\t\t\tlet model = new Model(args[1], args[2], theme, data, true)\n\t\t\tperipherals.model.push(model)\n\t\t\tdata.update(model.data)\n\t\t}\n\n\t\tif (args[0] === 'template') {\n\t\t\tperipherals.template.push(new Template(args[1], args[2], theme, true, true))\n\t\t}\n\t\tthis._outputs()\n\t}\n\t// An alias for register, create() is depreciated */\n\tcreate(...args) {\n\t\tthis.register(...args)\n\t}\n\t// An alias for create, add() is depreciated */\n\tadd(...args) {\n\t\tthis.create(...args)\n\t}\n\t_outputs() {\n\n\t\tthings = config.output.map(output => {\n\n\t\t\treturn new Output(output, peripherals, config, theme, data)\n\t\t})\n\t}\n\trender() {\n\t\tlet files = []\n\t\tfor (let output of things) {\n\t\t\t// console.log(output)\n\t\t\tlet file = {\n\t\t\t\tcontent: nunjucksEnv.renderString(output.template, output.model),\n\t\t\t\tpath: output.path\n\t\t\t}\n\t\t\tfiles.push(file)\n\t\t}\n\t\treturn files\n\t}\n\tbuild() {\n\t\tthis._outputs()\n\n\t\tfor (let file of this.render()) {\n\n\t\t\tfs.outputFile(file.path, file.content, function (err) {\n\t\t\t\tif (err) console.log(err) // => null\n\t\t\t\tif (env === 'test') {\n\t\t\t\t\tfs.readFile(file.path, 'utf8', function (err, data) {\n\t\t\t\t\t\tconsole.log(data) // => hello!\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t}\n\t}\n}\n\nconst mole = new Mole()\n\n// console.log(config)\n\n// mole.create('model', 'redModel', (theme, model) => {\n// \tmodel.color.red = \"#FF00000\"\n// \treturn model\n// })\n\n// console.log(config)\n// console.log(things)\n\n// mole.build()\n\n// mole.theme('src/stub/theme/override-theme.jsonnet')\n\n// console.log(data)\n\n// console.log(peripherals)\n\n// console.log(mole)\n\nif (env === 'test') {\n\tmole.build()\n}\n\nmole.debug = {\n\tconfig,\n\ttheme,\n\tdata,\n\toutputs: config.output,\n\tfiles,\n\tthings\n}\n\n// console.log(mole.render())\n\n// console.log(mole.debug)\n\nexport default mole\n"],"names":["env","process","NODE_ENV","arr","value","constructor","Array","empty","str","length","obj","Object","keys","err","Error","message","nll","noru","String","undef","undefined","is","bad","bool","date","Date","fn","inte","isFinite","Number","isInteger","json","JSON","parse","e","num","test","dir","path","prom","then","regex","RegExp","sym","typa","check","fn1","fn2","what","name","forEach","push","data","[object Object]","theme","assign","this","clone","jsonnet","require","RE_JS","RE_JSONNET","config","result","files","glob","sync","cwd","map","file","getThemePath","getFile","fs","readFileSync","toString","jsonnetVm","Jsonnet","eval","destroy","merge","input","existsSync","match","root","rootOnly","current","isArray","putValuesIntoArray","output","model","template","normaliseOutputs","set","peripherals","acc","strings","values","string","a","prefix","side","i","abbr","stripIndent","Template","func","active","deepFreeze","object","propNames","getOwnPropertyNames","freeze","Model","Output","getContent","type","getContentFromDirs","getFileContent","peripheral","console","log","join","update","nunjucksEnv","nunjucks","configure","things","mole","args","_outputs","register","create","content","renderString","render","outputFile","readFile","build","debug","outputs"],"mappings":"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"}